<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Working PDF Compressor - Reduce PDF File Size Online</title>
    <meta name="description" content="A reliable and free online tool to compress your PDF files. Reduces file size by optimizing JPEG images directly in your browser securely and quickly.">
    <meta name="keywords" content="pdf compressor, reduce pdf size, optimize pdf, compress pdf online, free pdf compressor, working pdf tool">
    <link rel="canonical" href="https://www.yourwebsite.com/pdf-compressor">

    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>

    <style>
        /* General Styling */
        :root {
            --primary-color: #0d6efd;
            --secondary-color: #6c757d;
            --success-color: #198754;
            --error-color: #dc3545;
            --light-gray: #f8f9fa;
            --border-color: #dee2e6;
            --text-color: #212529;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f1f3f5;
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 1.5rem 1rem;
        }

        /* Header */
        header {
            background: linear-gradient(90deg, #0d6efd, #0a58ca);
            color: white;
            text-align: center;
            padding: 2.5rem 1rem;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            margin-bottom: 0.5rem;
            font-size: 2.5rem;
        }

        /* Ad Spaces */
        .ad-space {
            background-color: var(--light-gray);
            border: 2px dashed var(--border-color);
            margin: 2rem 0;
            padding: 1.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100px;
            text-align: center;
            color: var(--secondary-color);
            border-radius: 8px;
        }

        /* Main Tool Section */
        .compressor-tool {
            background: #ffffff;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .upload-area {
            border: 3px dashed var(--border-color);
            border-radius: 10px;
            padding: 3rem 1.5rem;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
        }

        .upload-area:hover, .upload-area.dragover {
            background-color: #e9ecef;
            border-color: var(--primary-color);
        }

        .upload-area img {
            margin-bottom: 1rem;
            opacity: 0.7;
            pointer-events: none;
        }
        
        .upload-area p {
            font-size: 1.1rem;
            color: #495057;
        }

        .options {
            margin: 1.5rem 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        select#compression-level {
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background-color: #fff;
        }

        button, .download-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.8rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        button:hover, .download-btn:hover {
            background-color: #0a58ca;
            transform: translateY(-2px);
        }

        button:disabled {
            background-color: var(--secondary-color);
            cursor: not-allowed;
            transform: none;
        }

        /* Result & Progress */
        #result-section {
            margin-top: 2rem;
        }
        
        #status-heading {
            font-size: 1.5rem;
        }

        #status-heading.error {
            color: var(--error-color);
        }

        .progress-bar-container {
            width: 100%;
            background-color: #e9ecef;
            border-radius: 8px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-bar {
            width: 0%;
            height: 24px;
            background: linear-gradient(90deg, #198754, #20c997);
            border-radius: 8px;
            transition: width 0.4s ease;
        }

        #download-link {
            margin-top: 1rem;
            background-color: var(--success-color);
        }
        #download-link:hover {
            background-color: #157347;
        }

        /* Content Section */
        .content-section {
            margin-top: 3rem;
            padding: 2rem;
            background: #ffffff;
            border-radius: 12px;
        }

        .content-section h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .content-section ul {
            list-style-position: inside;
            padding-left: 0;
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 2rem;
            padding: 1.5rem;
            color: var(--secondary-color);
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            .container {
                padding: 1rem 0.5rem;
            }
            .compressor-tool, .content-section {
                padding: 1.5rem;
            }
            header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <h1>📄 PDF Size Reducer</h1>
            <p>Optimize your PDFs quickly and efficiently.</p>
        </div>
    </header>

    <main class="container">

        <div class="ad-space ad-banner-top">
            <p>Advertisement</p>
        </div>

        <section class="compressor-tool">
            <form id="pdf-form">
                <div class="upload-area" id="upload-area">
                    <img src="https://www.svgrepo.com/show/508608/upload.svg" alt="Upload Icon" width="60">
                    <p><strong>Drag & drop your PDF here</strong><br>or click to select a file.</p>
                    <input type="file" id="pdf-file" accept=".pdf" required hidden>
                </div>

                <div class="options">
                    <label for="compression-level">Image Quality:</label>
                    <select id="compression-level">
                        <option value="high">High Quality (Less Compression)</option>
                        <option value="medium" selected>Good Quality (Balanced)</option>
                        <option value="low">Low Quality (High Compression)</option>
                    </select>
                </div>

                <button type="submit" id="compress-btn">Compress PDF</button>
            </form>

            <div id="result-section" style="display:none;">
                <h2 id="status-heading">Processing...</h2>
                <p id="status-message">Your file is being compressed. Please wait.</p>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                <a href="#" id="download-link" class="download-btn" style="display:none;" download>Download Compressed PDF</a>
            </div>
        </section>
        
        <div class="ad-space ad-native-banner">
            <p>Advertisement</p>
        </div>

        <section class="content-section">
            <h2>How Our PDF Compressor Works</h2>
            <p>Our tool reduces the file size of your PDFs by optimizing the **JPEG images** within them. By selecting an image quality level, you can choose the balance between file size and image quality. The process happens right in your browser, ensuring your files are secure and private.</p>
            <h2>Features</h2>
            <ul>
                <li><strong>Multiple Compression Levels:</strong> Choose from three quality settings for JPEG images.</li>
                <li><strong>Secure & Private:</strong> All processing is done in your browser. Your files never leave your computer.</li>
                <li><strong>Completely Free:</strong> Compress as many files as you need, with no limits.</li>
                <li><strong>User-Friendly Interface:</strong> A simple drag-and-drop interface makes compression effortless.</li>
            </ul>
        </section>

    </main>

    <footer>
        <p>&copy; 2025 Your Website Name. All rights reserved.</p>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const pdfForm = document.getElementById('pdf-form');
            const pdfFileInput = document.getElementById('pdf-file');
            const uploadArea = document.getElementById('upload-area');
            const uploadAreaText = uploadArea.querySelector('p');
            const compressBtn = document.getElementById('compress-btn');
            const resultSection = document.getElementById('result-section');
            const statusHeading = document.getElementById('status-heading');
            const statusMessage = document.getElementById('status-message');
            const progressBar = document.getElementById('progress-bar');
            const downloadLink = document.getElementById('download-link');
            const compressionLevelSelect = document.getElementById('compression-level');

            const setupEventListeners = () => {
                uploadArea.addEventListener('click', () => pdfFileInput.click());
                pdfFileInput.addEventListener('change', () => {
                    if (pdfFileInput.files.length > 0) handleFile(pdfFileInput.files[0]);
                });

                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, preventDefaults, false);
                });
                ['dragenter', 'dragover'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, () => uploadArea.classList.add('dragover'), false);
                });
                ['dragleave', 'drop'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('dragover'), false);
                });
                uploadArea.addEventListener('drop', handleDrop, false);

                pdfForm.addEventListener('submit', handleFormSubmit);
            };

            const preventDefaults = (e) => {
                e.preventDefault();
                e.stopPropagation();
            };

            const handleDrop = (e) => {
                const file = e.dataTransfer.files[0];
                if (file && file.type === "application/pdf") {
                    pdfFileInput.files = e.dataTransfer.files;
                    handleFile(file);
                } else {
                    alert("Please drop a PDF file.");
                }
            };

            const handleFile = (file) => {
                uploadAreaText.innerHTML = `Selected File: <strong>${file.name}</strong>`;
                compressBtn.disabled = false;
            };

            const setUIState = (state, message = '') => {
                resultSection.style.display = 'block';
                statusHeading.classList.remove('error');
                
                switch (state) {
                    case 'processing':
                        statusHeading.textContent = 'Compressing...';
                        statusMessage.textContent = 'Loading and analyzing your PDF. Please wait.';
                        downloadLink.style.display = 'none';
                        compressBtn.disabled = true;
                        progressBar.style.width = '0%';
                        break;
                    case 'success':
                        statusHeading.textContent = '✅ Compression Complete!';
                        statusMessage.innerHTML = message;
                        downloadLink.style.display = 'inline-block';
                        compressBtn.disabled = false;
                        break;
                    case 'error':
                        statusHeading.textContent = '❌ An Error Occurred';
                        statusHeading.classList.add('error');
                        statusMessage.textContent = message;
                        downloadLink.style.display = 'none';
                        compressBtn.disabled = false;
                        break;
                }
            };

            const compressPdf = async (pdfFile, qualityLevel) => {
                const { PDFDocument, PDFName } = PDFLib;
                const qualityMap = { low: 0.5, medium: 0.75, high: 0.9 };
                const quality = qualityMap[qualityLevel];

                const existingPdfBytes = await pdfFile.arrayBuffer();
                const pdfDoc = await PDFDocument.load(existingPdfBytes, { updateMetadata: false });

                const jpegImageObjects = [];
                // **FIX:** A more robust way to find image objects
                const pages = pdfDoc.getPages();
                for (const page of pages) {
                    const xObjects = page.node.Resources()?.get(PDFName.of('XObject'))?.asDict();
                    if (!xObjects) continue;

                    for (const [key, value] of xObjects.entries()) {
                        const ref = value;
                        const stream = pdfDoc.context.lookup(ref);
                        if (stream?.dict.get(PDFName.of('Subtype')) === PDFName.of('Image')) {
                             if (stream.dict.get(PDFName.of('Filter')) === PDFName.of('DCTDecode')) {
                                jpegImageObjects.push(stream);
                            }
                        }
                    }
                }
                
                // Remove duplicates that might appear on multiple pages
                const uniqueJpegObjects = [...new Set(jpegImageObjects)];

                if (uniqueJpegObjects.length === 0) {
                    throw new Error(`This PDF contains images, but none are standard JPEGs that can be compressed.`);
                }

                statusMessage.textContent = `Found ${uniqueJpegObjects.length} JPEG image(s). Processing...`;

                for (let i = 0; i < uniqueJpegObjects.length; i++) {
                    const imageObject = uniqueJpegObjects[i];
                    const imageBytes = imageObject.getContents();
                    
                    try {
                        const blob = new Blob([imageBytes], { type: 'image/jpeg' });
                        const imageUrl = URL.createObjectURL(blob);

                        const image = await new Promise((resolve, reject) => {
                            const img = new Image();
                            img.onload = () => resolve(img);
                            img.onerror = reject;
                            img.src = imageUrl;
                        });
                        
                        URL.revokeObjectURL(imageUrl);

                        const canvas = document.createElement('canvas');
                        canvas.width = image.width;
                        canvas.height = image.height;
                        canvas.getContext('2d').drawImage(image, 0, 0);

                        const compressedImageBytes = await new Promise(resolve => {
                            canvas.toBlob(blob => {
                                const reader = new FileReader();
                                reader.onload = () => resolve(new Uint8Array(reader.result));
                                reader.readAsArrayBuffer(blob);
                            }, 'image/jpeg', quality);
                        });

                        imageObject.contents = compressedImageBytes;
                        imageObject.dict.set(PDFName.of('Length'), PDFLib.PDFNumber.of(compressedImageBytes.length));
                    } catch (e) {
                        console.warn('Skipping an image that could not be processed:', e);
                    }
                    progressBar.style.width = `${((i + 1) / uniqueJpegObjects.length) * 100}%`;
                }

                const newPdfBytes = await pdfDoc.save();
                return new Blob([newPdfBytes], { type: 'application/pdf' });
            };

            const handleFormSubmit = async (e) => {
                e.preventDefault();
                const file = pdfFileInput.files[0];
                if (!file) {
                    alert("Please select a file first.");
                    return;
                }

                setUIState('processing');

                try {
                    const originalSize = (file.size / 1024 / 1024).toFixed(2);
                    const compressedBlob = await compressPdf(file, compressionLevelSelect.value);
                    const compressedSize = (compressedBlob.size / 1024 / 1024).toFixed(2);
                    const reduction = originalSize > 0.01 ? Math.round(((originalSize - compressedSize) / originalSize) * 100) : 0;

                    let successMessage;
                    if (reduction < 0) {
                        successMessage = `File is already optimized! Original: <strong>${originalSize} MB</strong>. New: <strong>${compressedSize} MB</strong>.`;
                    } else {
                        successMessage = `Original: <strong>${originalSize} MB</strong> &rarr; New: <strong>${compressedSize} MB</strong> (Reduced by ${reduction}%)`;
                    }
                    
                    const downloadUrl = URL.createObjectURL(compressedBlob);
                    downloadLink.href = downloadUrl;
                    downloadLink.download = `compressed_${file.name}`;
                    
                    setUIState('success', successMessage);
                } catch (error) {
                    console.error("Compression Error:", error);
                    setUIState('error', error.message || 'Could not process the PDF. It might be corrupted or password-protected.');
                }
            };

            setupEventListeners();
        });
    </script>

</body>
</html>
