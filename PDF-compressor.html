<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Functional PDF Compressor - Reduce PDF File Size Instantly</title>
    <meta name="description" content="Compress your PDF files to a smaller size online for free. This tool actually reduces file size by optimizing JPEG images within the PDF.">
    <meta name="keywords" content="pdf compressor, reduce pdf size, optimize pdf, compress pdf online, free pdf compressor, functional pdf tool">
    <link rel="canonical" href="https://www.yourwebsite.com/pdf-compressor">

    <script type='text/javascript' src='//pl2345678.highcpmgate.com/YOUR_ADSTERRA_HEAD_SCRIPT_ID/invoke.js'></script>
    
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>

    <style>
        /* Basic Styles */
        :root {
            --primary-color: #007bff;
            --secondary-color: #f8f9fa;
            --text-color: #333;
            --border-color: #ddd;
            --success-color: #28a745;
            --error-color: #dc3545;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f4f7f6;
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 2rem 1rem;
            border-bottom-left-radius: 15px;
            border-bottom-right-radius: 15px;
        }

        header h1 {
            margin-bottom: 0.5rem;
        }

        /* Ad Spaces */
        .ad-space {
            background-color: #e9ecef;
            border: 2px dashed var(--border-color);
            margin: 20px 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 90px;
            text-align: center;
            color: #6c757d;
        }

        /* Compressor Tool */
        .compressor-tool {
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .upload-area {
            border: 3px dashed var(--border-color);
            border-radius: 8px;
            padding: 40px 20px;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
        }

        .upload-area:hover, .upload-area.dragover {
            background-color: var(--secondary-color);
            border-color: var(--primary-color);
        }

        .upload-area img {
            margin-bottom: 15px;
            opacity: 0.7;
        }

        .options {
            margin: 20px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }

        select#compression-level {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
        }

        button, .download-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        button:hover, .download-btn:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }

        button:disabled {
            background-color: #a0a0a0;
            cursor: not-allowed;
            transform: none;
        }

        /* Result Section */
        #result-section {
            margin-top: 25px;
        }
        
        #status-heading.error {
            color: var(--error-color);
        }

        .progress-bar-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-bar {
            width: 0%;
            height: 20px;
            background-color: var(--success-color);
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }

        #download-link {
            margin-top: 20px;
            background-color: var(--success-color);
        }
        #download-link:hover {
            background-color: #218838;
        }

        /* Content Section */
        .content-section {
            margin-top: 40px;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
        }

        .content-section h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .content-section ul {
            list-style-position: inside;
            padding-left: 0;
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #6c757d;
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            .options {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <h1>📄 PDF Size Reducer</h1>
            <p>Optimize your PDFs quickly and efficiently.</p>
        </div>
    </header>

    <main class="container">

        <div class="ad-space ad-banner-top">
            <p>Advertisement</p>
        </div>

        <section class="compressor-tool">
            <form id="pdf-form">
                <div class="upload-area" id="upload-area">
                    <img src="https://www.svgrepo.com/show/493608/pdf-file.svg" alt="Upload PDF Icon" width="80">
                    <p><strong>Drag & drop your PDF here</strong> or click to select a file.</p>
                    <input type="file" id="pdf-file" accept=".pdf" required hidden>
                </div>

                <div class="options">
                    <label for="compression-level">Image Quality:</label>
                    <select id="compression-level">
                        <option value="high">High Quality (Less Compression)</option>
                        <option value="medium" selected>Good Quality (Balanced)</option>
                        <option value="low">Low Quality (High Compression)</option>
                    </select>
                </div>

                <button type="submit" id="compress-btn">Compress PDF</button>
            </form>

            <div id="result-section" style="display:none;">
                <h2 id="status-heading">Processing...</h2>
                <p id="status-message">Your file is being compressed. Please wait.</p>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                <a href="#" id="download-link" class="download-btn" style="display:none;" download>Download Compressed PDF</a>
            </div>
        </section>
        
        <div class="ad-space ad-native-banner">
            <p>Advertisement</p>
        </div>

        <section class="content-section">
            <h2>How Our PDF Compressor Works</h2>
            <p>Our tool reduces the file size of your PDFs by optimizing the **JPEG images** within them. By selecting an image quality level, you can choose the balance between file size and image quality. The process happens right in your browser, ensuring your files are secure and private.</p>

            <h2>Features</h2>
            <ul>
                <li><strong>Multiple Compression Levels:</strong> Choose from three quality settings for JPEG images.</li>
                <li><strong>Secure & Private:</strong> All processing is done in your browser. Your files never leave your computer.</li>
                <li><strong>Completely Free:</strong> Compress as many files as you need, with no limits.</li>
                <li><strong>User-Friendly Interface:</strong> A simple drag-and-drop interface makes compression effortless.</li>
            </ul>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Your Website Name. All rights reserved.</p>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const pdfForm = document.getElementById('pdf-form');
            const pdfFileInput = document.getElementById('pdf-file');
            const uploadArea = document.getElementById('upload-area');
            const uploadAreaText = uploadArea.querySelector('p');
            const compressBtn = document.getElementById('compress-btn');
            const resultSection = document.getElementById('result-section');
            const statusHeading = document.getElementById('status-heading');
            const statusMessage = document.getElementById('status-message');
            const progressBar = document.getElementById('progress-bar');
            const downloadLink = document.getElementById('download-link');
            const compressionLevelSelect = document.getElementById('compression-level');

            // Handle file selection via click
            uploadArea.addEventListener('click', () => pdfFileInput.click());

            // Handle file selection via change event
            pdfFileInput.addEventListener('change', () => {
                if (pdfFileInput.files.length > 0) {
                    handleFile(pdfFileInput.files[0]);
                }
            });

            // Handle drag and drop
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, () => uploadArea.classList.add('dragover'), false);
            });
            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('dragover'), false);
            });
            uploadArea.addEventListener('drop', handleDrop, false);

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            function handleDrop(e) {
                const file = e.dataTransfer.files[0];
                if (file && file.type === "application/pdf") {
                    pdfFileInput.files = e.dataTransfer.files; // Assign dropped file to input
                    handleFile(file);
                } else {
                    alert("Please drop a PDF file.");
                }
            }

            function handleFile(file) {
                uploadAreaText.textContent = `Selected File: ${file.name}`;
                compressBtn.disabled = false;
            }

            // =================================================================
            // == UPDATED, MORE ROBUST COMPRESSION LOGIC                     ==
            // =================================================================
            async function compressPdf(pdfFile, qualityLevel) {
                const { PDFDocument, PDFName } = PDFLib;

                const qualityMap = {
                    low: 0.5,
                    medium: 0.75,
                    high: 0.9,
                };
                const quality = qualityMap[qualityLevel];

                const existingPdfBytes = await pdfFile.arrayBuffer();
                const pdfDoc = await PDFDocument.load(existingPdfBytes);

                // **FIX:** Find all image objects first, then filter for JPEGs.
                const allImageObjects = [];
                pdfDoc.context.indirectObjects.forEach((pdfObject) => {
                    if (pdfObject.dict?.get(PDFName.of('Subtype')) === PDFName.of('Image')) {
                        allImageObjects.push(pdfObject);
                    }
                });
                
                // Now, filter those images to find only the JPEGs by checking their encoding filter.
                const jpegImageObjects = allImageObjects.filter(pdfObject => {
                    const filter = pdfObject.dict.get(PDFName.of('Filter'));
                    return filter === PDFName.of('DCTDecode');
                });

                if (jpegImageObjects.length === 0) {
                    throw new Error(`This PDF contains ${allImageObjects.length} image(s), but none are compatible JPEGs that can be compressed.`);
                }

                statusMessage.textContent = `Found ${jpegImageObjects.length} JPEG image(s) to process...`;

                for (let i = 0; i < jpegImageObjects.length; i++) {
                    const imageObject = jpegImageObjects[i];
                    const imageBytes = imageObject.getContents();
                    
                    try {
                        // Use browser's native capabilities to re-compress the image
                        const blob = new Blob([imageBytes], { type: 'image/jpeg' });
                        const imageUrl = URL.createObjectURL(blob);

                        const image = await new Promise((resolve, reject) => {
                            const img = new Image();
                            img.onload = () => resolve(img);
                            img.onerror = (err) => reject(new Error('Could not decode an image. It may be corrupt.'));
                            img.src = imageUrl;
                        });
                        
                        URL.revokeObjectURL(imageUrl);

                        const canvas = document.createElement('canvas');
                        canvas.width = image.width;
                        canvas.height = image.height;
                        const context = canvas.getContext('2d');
                        context.drawImage(image, 0, 0);

                        const compressedImageBytes = await new Promise(resolve => {
                            canvas.toBlob(blob => {
                                const reader = new FileReader();
                                reader.onload = () => resolve(new UintArray(reader.result));
                                reader.readAsArrayBuffer(blob);
                            }, 'image/jpeg', quality);
                        });

                        // Replace the old image stream with the new compressed one
                        imageObject.contents = compressedImageBytes;
                        imageObject.dict.set(PDFName.of('Length'), PDFLib.PDFNumber.of(compressedImageBytes.length));

                    } catch (e) {
                        console.warn('Skipping an image that could not be processed:', e);
                    } finally {
                         // Update progress regardless of individual image success
                        const progress = ((i + 1) / jpegImageObjects.length) * 100;
                        progressBar.style.width = `${progress}%`;
                    }
                }

                const newPdfBytes = await pdfDoc.save();
                return new Blob([newPdfBytes], { type: 'application/pdf' });
            }


            pdfForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const file = pdfFileInput.files[0];
                if (!file) {
                    alert("Please select a PDF file first.");
                    return;
                }

                resultSection.style.display = 'block';
                statusHeading.textContent = 'Compressing...';
                statusHeading.classList.remove('error');
                downloadLink.style.display = 'none';
                compressBtn.disabled = true;
                progressBar.style.width = '0%';
                
                try {
                    statusMessage.textContent = 'Loading PDF file... Please wait.';
                    const originalSize = (file.size / 1024 / 1024).toFixed(2);

                    const compressedBlob = await compressPdf(file, compressionLevelSelect.value);
                    
                    const compressedSize = (compressedBlob.size / 1024 / 1024).toFixed(2);
                    const reduction = originalSize > 0 ? Math.round(((originalSize - compressedSize) / originalSize) * 100) : 0;

                    // Handle case where compression makes the file larger (can happen with already optimized images)
                    if (reduction < 0) {
                         statusMessage.textContent = `File is already optimized! Original size: ${originalSize} MB. New size: ${compressedSize} MB.`;
                    } else {
                         statusMessage.textContent = `Success! Original size: ${originalSize} MB. New size: ${compressedSize} MB. (Reduced by ${reduction}%)`;
                    }

                    const downloadUrl = URL.createObjectURL(compressedBlob);
                    
                    statusHeading.textContent = '✅ Compression Complete!';
                    downloadLink.href = downloadUrl;
                    downloadLink.download = `compressed_${file.name}`;
                    downloadLink.style.display = 'block';

                } catch (error) {
                    statusHeading.textContent = '❌ An Error Occurred';
                    statusHeading.classList.add('error');
                    statusMessage.textContent = error.message || 'Could not process the PDF. Please try another file.';
                    console.error(error);
                } finally {
                    compressBtn.disabled = false;
                }
            });
        });
    </script>
</body>
</html>
