<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PDFCompressPro â€” Simulated Compressor (fixed download)</title>
  <meta name="description" content="Simulated PDF compressor â€” downloads file sized to the compressed result." />
  <style>
    body { margin:0; font-family: 'Segoe UI', Tahoma, Arial, sans-serif; background:#1d4ed8; color:#fff; text-align:center; }
    header{padding:20px 10px}
    header h1{margin:0;font-size:2rem}
    header p{margin-top:6px;color:#dbeafe}
    .container{max-width:1100px;margin:20px auto;display:grid;grid-template-columns:2fr 1fr;gap:20px;padding:0 10px}
    .tool-card{background:#fff;color:#111;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.15)}
    .upload-box{border:2px dashed #2563eb;border-radius:10px;padding:30px;margin-bottom:20px;background:#eff6ff}
    .upload-box p{color:#1e3a8a;font-weight:500}
    .btn{background:#2563eb;color:#fff;border:none;padding:10px 20px;margin-top:10px;border-radius:8px;cursor:pointer;font-size:1rem;transition:.3s}
    .btn:hover{background:#1e40af}
    .slider-container{margin:20px 0;text-align:left}
    .slider-container input{width:100%}
    .compare{display:flex;justify-content:space-around;margin-top:20px;font-size:.9rem}
    .compare div{flex:1}
    .ads{display:flex;flex-direction:column;gap:20px}
    .ad-box{background:#dbeafe;color:#1e40af;border:2px dashed #93c5fd;border-radius:10px;height:160px;display:flex;align-items:center;justify-content:center;font-weight:500}
    .features{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin:30px auto;max-width:1100px;padding:0 10px}
    .feature-card{background:#fff;color:#111;padding:15px;border-radius:12px;font-size:.9rem;box-shadow:0 4px 10px rgba(0,0,0,.1)}
    .feature-card h3{margin:0 0 8px;font-size:1rem;color:#2563eb}
    footer{margin-top:20px;padding:15px;font-size:.85rem;color:#dbeafe}
    @media(max-width:900px){.container{grid-template-columns:1fr}.features{grid-template-columns:1fr 1fr}}
    @media(max-width:500px){.features{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <h1>PDFCompressPro</h1>
    <p>Compress and download a simulated PDF sized to the compression result</p>
  </header>

  <div class="container">
    <div class="tool-card">
      <h2>ðŸ“‰ PDF Compressor Tool â€” Fixed Download</h2>

      <div class="upload-box">
        <p>Upload Your PDF</p>
        <input type="file" id="upload" accept="application/pdf" style="display:none" />
        <button class="btn" id="selectBtn">Select PDF</button>
        <p id="fileName" style="margin-top:10px;color:#1e3a8a"></p>
      </div>

      <div class="slider-container">
        <label for="compression">Compression Level: <span id="value">50%</span></label>
        <input type="range" id="compression" min="10" max="100" value="50">
      </div>

      <div class="compare">
        <div>
          <p>Original PDF</p>
          <span id="originalSize">--</span>
        </div>
        <div>
          <p>Compressed PDF</p>
          <span id="compressedSize">--</span>
        </div>
      </div>

      <button class="btn" id="compressBtn">Compress PDF</button><br>
      <a id="downloadLink" class="btn" style="display:none;margin-top:15px" download>Download compressed.pdf</a>
    </div>

    <div class="ads">
      <div class="ad-box">AdSense Ad 300x250</div>
      <div class="ad-box">AdSense Ad 300x600</div>
    </div>
  </div>

  <div class="features">
    <div class="feature-card"><h3>ðŸ“‰ Smart Compression</h3><p>From 100KB (super small) to full size based on slider.</p></div>
    <div class="feature-card"><h3>ðŸ”’ 100% Secure</h3><p>All processing is local (simulation) â€” no uploads.</p></div>
    <div class="feature-card"><h3>ðŸ“± Mobile Ready</h3><p>Use the compressor from any device.</p></div>
    <div class="feature-card"><h3>â¬‡ Instant Download</h3><p>Download the simulated compressed file immediately.</p></div>
  </div>

  <footer>Â© 2025 PDFCompressPro â€” Simulation mode</footer>

  <script>
    const compression = document.getElementById('compression');
    const value = document.getElementById('value');
    const selectBtn = document.getElementById('selectBtn');
    const upload = document.getElementById('upload');
    const fileName = document.getElementById('fileName');
    const originalSizeEl = document.getElementById('originalSize');
    const compressedSizeEl = document.getElementById('compressedSize');
    const compressBtn = document.getElementById('compressBtn');
    const downloadLink = document.getElementById('downloadLink');

    let originalFileSize = 0;
    let originalFileName = 'file.pdf';
    let currentObjectUrl = null;

    compression.addEventListener('input', () => {
      value.textContent = compression.value + '%';
    });

    selectBtn.addEventListener('click', () => upload.click());

    upload.addEventListener('change', () => {
      if (!upload.files || upload.files.length === 0) {
        fileName.textContent = '';
        originalSizeEl.textContent = '--';
        originalFileSize = 0;
        return;
      }
      const file = upload.files[0];
      originalFileName = file.name || 'file.pdf';
      fileName.textContent = "Selected: " + originalFileName;
      originalFileSize = file.size;
      originalSizeEl.textContent = (originalFileSize / 1024 / 1024).toFixed(2) + " MB";

      // Hide previous download link (if any)
      if (currentObjectUrl) {
        URL.revokeObjectURL(currentObjectUrl);
        currentObjectUrl = null;
      }
      downloadLink.style.display = 'none';
    });

    // Helper: create a PDF-like blob of target size
    function makePdfLikeBlob(targetBytes) {
      // Basic textual PDF header/footer
      const headerStr = "%PDF-1.3\n%Ã¢Ã£ÃÃ“\n";
      const footerStr = "\n%%EOF\n";

      const encoder = new TextEncoder();
      const header = encoder.encode(headerStr);
      const footer = encoder.encode(footerStr);

      // Ensure target is at least header + footer + 1
      let fillerLength = Math.max(0, targetBytes - header.length - footer.length);
      // Build filler (space bytes)
      const filler = new Uint8Array(fillerLength);
      filler.fill(0x20); // space

      // Concatenate header + filler + footer
      const out = new Uint8Array(header.length + filler.length + footer.length);
      out.set(header, 0);
      out.set(filler, header.length);
      out.set(footer, header.length + filler.length);

      return new Blob([out], { type: 'application/pdf' });
    }

    compressBtn.addEventListener('click', () => {
      if (!originalFileSize || originalFileSize <= 0) {
        alert("Please select a PDF first!");
        return;
      }

      // compression slider: 10 -> 100
      const sliderValue = Number(compression.value);

      // Map 10% => 100 KB, 100% => originalFileSize (linear interpolation)
      const minBytes = 100 * 1024; // 100 KB
      const maxBytes = originalFileSize;
      const t = (sliderValue - 10) / (100 - 10); // 0..1
      const targetBytes = Math.round(minBytes + t * (maxBytes - minBytes));

      compressedSizeEl.textContent = (targetBytes / 1024 / 1024).toFixed(2) + " MB";

      // build a PDF-like blob exactly targetBytes long and provide it for download
      if (currentObjectUrl) {
        URL.revokeObjectURL(currentObjectUrl);
        currentObjectUrl = null;
      }

      const blob = makePdfLikeBlob(targetBytes);
      currentObjectUrl = URL.createObjectURL(blob);

      // set download filename based on original name
      const dotIndex = originalFileName.lastIndexOf('.');
      const baseName = dotIndex > 0 ? originalFileName.slice(0, dotIndex) : originalFileName;
      const outName = baseName + '-compressed.pdf';
      downloadLink.download = outName;
      downloadLink.href = currentObjectUrl;
      downloadLink.style.display = 'inline-block';

      // user message
      alert("PDF compressed (simulation). The downloaded file is sized to the simulated compressed result.");
    });

    // revoke URL when page unloads
    window.addEventListener('beforeunload', () => {
      if (currentObjectUrl) URL.revokeObjectURL(currentObjectUrl);
    });
  </script>
</body>
</html>
